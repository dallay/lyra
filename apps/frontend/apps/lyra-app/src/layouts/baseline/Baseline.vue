<script lang="ts" setup>
import { onMounted, reactive, ref, watch } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { useLocaler } from 'vue-localer';
import {
	request,
	XButton,
	XDialog,
	XDrawer,
	XKeyboard,
	XListbox,
	XPopover,
	XTextField,
} from '@lyra/ui';
import { useColorMode, useTextDirection } from '@vueuse/core';

import type { Link } from './links-list';
import useStore from './store';
import Navbar from './Navbar.vue';
import IdleDialog from './IdleDialog.vue';

const router = useRouter();
const route = useRoute();
const localer = useLocaler();

const colorMode = useColorMode();
const textDirection = useTextDirection();

const { state } = useStore();

export interface UserData {
	message: string;
	_id: string;
	username: string;
	email: string;
	fullName: string;
	status: boolean;
	otpEnabled: boolean;
	otpVerified: boolean;
	createdAt: string;
	updatedAt: string;
	role: string;
	permissions: Permission[];
}

export interface Permission {
	resource: string;
	action: string;
}

const flux = reactive({
	user: {} as UserData,
	userError: {} as any,

	signOut() {
		localStorage.removeItem('accessToken');
		localStorage.removeItem('refreshToken');
		router.push('/sign-in');
	},
	authDialog: false,
	changeLang(val: string) {
		localStorage.setItem('language', val);
	},
	searchDialog: false,

	navDrawer: false,

	avatar(fullName: string) {
		const arr = fullName?.split(' ');
		if (arr?.length > 1) return arr[0][0] + arr[1][0];
		return arr?.[0][0];
	},
});

watch(
	() => flux.authDialog,
	(val) => {
		if (!val) {
			localStorage.removeItem('accessToken');
			localStorage.removeItem('refreshToken');
			router.push('/sign-in');
		}
	}
);

watch(
	() => route.path,
	() => {
		if (flux.navDrawer) flux.navDrawer = false;
	}
);

function setStatus(link: Link, sub: Link['sub'], parentLink?: Link) {
	if (sub?.length) {
		sub.forEach((subLink) => {
			if (subLink.to === route.path) {
				if (parentLink) parentLink.status = true;
				link.status = true;
			} else if (subLink.to && route.path.startsWith(subLink.to)) {
				if (parentLink) parentLink.status = true;
				link.status = true;
			}

			if (subLink.sub?.length) {
				setStatus(subLink, subLink.sub, link);
			}
		});
	}
}

state.listOfLinks.forEach((link) => {
	setStatus(link, link.sub);
});

onMounted(async () => {
	const response = await request<UserData>('/auth/user', { method: 'GET' });

	state.userLoading = false;

	if (response.status === 200) {
		flux.user = response._data as UserData;
	}

	if (400 <= response.status && response.status <= 500) {
		flux.authDialog = true;
		flux.userError = response._data;
	}
});

type MenuType = '' | 'appearance' | 'language';

const menuStatus = ref(false);
const menuType = ref<MenuType>('');

function menu(type: MenuType) {
	menuType.value = type;
}

watch(
	() => menuStatus.value,
	(val) => {
		if (!val) {
			menuType.value = '';
		}
	}
);

const languageOptions = [
	{ label: 'English', value: 'en-US' },
	{ label: '日本語', value: 'ja-JP' },
	{ label: '한국어', value: 'ko-KR' },
	{ label: '正體中文', value: 'zh-TW' },
];

function changeLang(lang: string) {
	localer.lang.value = lang;
	document.documentElement.lang = lang;
	localStorage.setItem('language', lang);
}
</script>

<template>
	<div class="h-full">
		<header class="Topbar">
			<div
				class="i-material-symbols-menu-rounded h-7 w-7 cursor-pointer transition hover:scale-125 xl:hidden"
				@click="flux.navDrawer = true"
			></div>

			<svg
				xmlns="http://www.w3.org/2000/svg"
				class="max-w-30vw cursor-pointer"
				width="192"
				height="40"
				viewBox="0 0 192 40"
				@click="router.push('/')"
			>
				<path
					class="fill-primary-500"
					d="M37.717-.875c-.263.142-.335.299-.58 1.304-.533 2.11-1.263 3.854-2.184 5.19-.449.654-.664.926-1.77 2.215-1.419 1.654-2.04 2.812-2.34 4.33-.132.691-.126 2.063.006 2.739.06.283.096.524.084.54-.018.01-.293-.085-.622-.21-1.287-.492-2.974-.964-4.822-1.346-.52-.105-.599-.11-.796-.042-.473.157-.449.021-.49 2.953-.072 5.221-.066 5.703.12 6.635.418 2.105 1.291 3.943 2.661 5.619 1.7 2.073 3.93 3.576 7.251 4.87.55.214.67.24.945.22.371-.021.593-.178.664-.461.048-.189.024-.293-.257-1.12a10.948 10.948 0 0 1-.24-6.206 12.922 12.922 0 0 1 2.268-4.66c1.017-1.325 1.89-2.163 3.829-3.666 2.136-1.655 2.961-2.519 3.673-3.844a8.53 8.53 0 0 0 .963-4.749 9.952 9.952 0 0 0-.101-.937c-.036-.173-.03-.178.071-.105.108.079.658.696 1.071 1.204 1.538 1.885 2.19 3.268 2.37 5.064.071.665.041 1.236-.096 1.98-.216 1.178-.796 2.162-1.741 2.963-.485.409-1.03.78-1.149.78-.036 0-.066.021-.066.048 0 .026-.072.062-.155.078-.09.021-.246.094-.347.157-.24.157-.754.356-.754.288 0-.026.03-.047.066-.047.03 0 .048-.02.03-.047-.024-.026.024-.037.095-.026.078.01.102.01.066-.01-.06-.022-.06-.048.006-.105.114-.095.18-.095.132.005-.054.126.036.094.293-.1.131-.1.27-.167.323-.146.054.015.072.005.042-.032-.024-.036-.006-.063.048-.063.053 0 .095-.026.095-.052 0-.031-.077-.02-.18.026-.197.09-.418.105-.418.026 0-.094-.131-.057-.161.048a.21.21 0 0 1-.126.13c-.06.016-.138.048-.174.063-.047.016-.077-.005-.077-.052s-.03-.084-.066-.084c-.042 0-.06.063-.042.147.024.13.006.146-.132.125-.161-.02-.418.11-.347.179.03.02.096 0 .156-.048.126-.1.191-.115.191-.036 0 .026-.041.052-.09.052-.09 0-.227.173-.173.22.012.016-.329.141-.766.272-.436.136-.873.278-.975.32a45.26 45.26 0 0 1-.658.24c-.634.231-1.555.78-2.195 1.315-1.424 1.189-2.262 2.555-2.692 4.388-.15.644-.18.922-.21 1.833-.036 1.141.018 1.775.228 2.67.496 2.147 1.806 4.216 3.822 6.043.754.686.963.817 1.298.817.377 0 .653-.13.826-.392.293-.43.174-.786-.485-1.44-.777-.775-1.908-2.048-2.225-2.52l-.132-.188 1.125-.031a25.398 25.398 0 0 0 1.735-.115c3.242-.409 6.162-1.645 8.453-3.577 2.244-1.89 3.626-4.163 4.206-6.922.21-.985.275-1.765.275-3.21 0-1.372-.024-1.482-.359-1.634-.353-.157-.52-.11-1.412.393-1.8 1.026-3.308 1.55-5.049 1.754-.347.042-.652.078-.676.078-.03 0 .138-.178.371-.398 2.13-1.995 2.848-4.953 1.938-8.006-.556-1.875-1.687-3.619-3.47-5.336-.993-.964-2.77-2.351-3.332-2.608-.43-.194-.921-.031-1.029.346-.018.068.078.586.216 1.157.347 1.471.478 2.461.478 3.56 0 2.415-.682 4.001-2.369 5.499-.191.173-.831.676-1.412 1.11-1.4 1.058-1.998 1.56-2.68 2.262-.64.66-.67.655-.508-.063.131-.58.412-1.372.652-1.832.269-.519.945-1.377 1.543-1.97 1.197-1.188 1.915-2.026 2.303-2.69 1.418-2.451 1.269-5.892-.406-9.264-.754-1.53-2.202-3.598-2.704-3.865a.761.761 0 0 0-.748 0zm1.202 3.834c.55.895 1.155 2.44 1.43 3.655.114.508.138.775.138 1.701 0 1.158-.048 1.514-.305 2.2-.33.895-.844 1.602-2.04 2.796-.395.393-.922.948-1.179 1.236-.251.288-.479.544-.503.576-.125.141-.616.979-.73 1.24-.095.226-.149.294-.22.268-.073-.026-.084-.005-.055.073a.143.143 0 0 1-.053.173c-.048.037-.09.094-.09.126 0 .031.024.02.06-.021.095-.136.107-.032.012.157-.054.1-.096.204-.102.235 0 .027-.03.168-.054.315-.048.22-.06.24-.102.141-.03-.068-.077-.11-.107-.094s-.042-.016-.024-.068c.018-.068-.018-.131-.126-.189-.084-.052-.137-.11-.12-.141.018-.026.102.02.186.1.138.135.144.135.108.026-.024-.074-.012-.116.036-.116.047 0 .053.058.03.168-.024.126-.018.152.023.094a.546.546 0 0 0 .06-.256c0-.137-.018-.163-.078-.12-.047.036-.107.036-.161.01-.048-.032-.066-.053-.036-.053.03 0 .018-.036-.024-.078-.048-.053-.126-.068-.227-.042-.132.026-.144.015-.108-.068.042-.095.036-.095-.072.005-.066.058-.101.126-.083.152.011.02.041.02.065-.005.018-.027.084-.006.144.047.09.083.09.094.006.094-.084 0-.09.01-.018.089.078.084.072.089-.018.026-.06-.042-.084-.105-.066-.152.024-.057.012-.073-.03-.047-.083.042-.395-.251-.4-.382-.024-.236-.036-.272-.09-.241-.048.026-.042.058.006.11.036.042.054.089.036.105-.054.047-.652-.87-.617-.953.018-.042.012-.068-.018-.053-.065.037-.34-.618-.454-1.094-.138-.555-.174-1.393-.096-2.032.174-1.372.76-2.445 2.202-4.016 1.645-1.796 2.901-3.922 3.487-5.907.036-.12.072-.22.084-.22.018 0 .144.194.293.43zM28.187 16.484c1.202.356 2.363.786 3.135 1.158.502.246 1.076.58 1.106.66.012.02.048.041.084.041.203 0 1.932 1.545 2.662 2.372l.401.466-.138.215c-.765 1.184-1.202 2.042-1.62 3.184-.42 1.157-.39 1.105-.48.911-.125-.293-.945-1.676-1.28-2.168-.185-.272-.335-.513-.335-.54 0-.02-.041-.025-.09-.01-.065.026-.077.01-.053-.052.024-.047 0-.126-.048-.178a1.46 1.46 0 0 1-.162-.23c-.047-.08-.113-.131-.143-.11-.036.015-.042.005-.018-.027.018-.031-.06-.183-.186-.34-.161-.21-.25-.278-.329-.257-.06.01-.107-.005-.107-.042 0-.036-.048-.047-.132-.026-.102.026-.114.021-.048-.02.072-.043.072-.074.006-.179a.345.345 0 0 1-.036-.251c.03-.1.024-.11-.024-.047a.33.33 0 0 0-.065.183c0 .079-.012.09-.054.032-.03-.037-.084-.053-.12-.037-.036.02-.066.016-.066-.016 0-.026.036-.063.078-.073.036-.016.048-.032.012-.032-.173-.01-.221.084-.161.315.03.125.06.193.065.141.006-.058.042-.079.126-.058.066.016.12.068.114.116 0 .052-.012.057-.036.015-.012-.031-.054-.063-.084-.063-.066 0-.048.268.024.351.03.037.042.068.024.068-.078 0 .293.791.395.828.024.01.042.073.042.136 0 .063.023.136.053.162.03.032.126.204.216.393.245.534.245.534.377.785.436.823.598 1.147.861 1.728.168.362.323.713.353.786.024.073.144.35.257.623.222.503.252.723.168 1.21-.042.214-.06.235-.192.22a.406.406 0 0 1-.209-.084c-.066-.068-.275-.157-.341-.147-.03.005-.048-.026-.048-.068 0-.042-.042-.078-.096-.078-.053 0-.161-.058-.239-.131-.072-.074-.173-.12-.215-.116-.042.011-.06.011-.03 0 .078-.041.048-.12-.048-.12a.144.144 0 0 1-.126-.078c-.024-.042-.06-.063-.09-.048-.03.016-.053-.02-.053-.073 0-.078-.03-.1-.12-.078-.096.02-.114.01-.078-.063.024-.068.018-.084-.03-.058-.041.021-.113 0-.167-.042-.054-.047-.191-.084-.33-.084-.167 0-.232-.02-.232-.078 0-.042-.042-.079-.09-.079-.048 0-.09.016-.09.042 0 .074.245.225.347.21.06-.01.102.026.114.089l.018.104-.054-.104c-.048-.084-.06-.084-.06-.021-.006.12-.215.157-.55.094a1.617 1.617 0 0 0-.455-.031c-.144.015-.132.02.054.031.263.005.526.089.526.162 0 .027-.054.053-.12.053-.16 0-.149.073.019.146l.131.058h-.131c-.114.005-.138.037-.138.188 0 .1.03.184.066.184.03 0 .042.026.018.063-.024.031-.042.162-.042.288.006.188-.012.22-.078.167-.096-.068-.114-.12-.024-.073.036.02.06-.037.06-.142 0-.136-.018-.157-.066-.094s-.054.053-.024-.042c.042-.13-.072-.157-.28-.057-.09.042-.115.042-.085 0 .024-.032.018-.058-.018-.058-.035 0-.053-.068-.041-.157.011-.089-.006-.147-.048-.141-.036.005-.06-.016-.054-.048.006-.031-.036-.057-.09-.057-.21 0-.251-.016-.251-.105 0-.047-.018-.073-.036-.052-.024.015-.09-.021-.144-.084-.077-.084-.09-.136-.048-.183.036-.037.048-.079.024-.1-.018-.015-.035-.005-.035.026 0 .037-.024.063-.06.063-.03 0-.06-.036-.06-.078s-.024-.079-.054-.079c-.09 0-.132-.173-.054-.22.054-.031.048-.042-.03-.031-.173.026-.933-1.095-.837-1.23.018-.027.006-.037-.024-.022-.114.063-.586-1.01-.856-1.953-.412-1.45-.514-2.53-.406-4.388.077-1.367.09-3.383.023-3.702l-.041-.178.43.11c.234.057.928.251 1.544.434zm6.652 1.11c.078.084.072.09-.018.021-.06-.036-.107-.078-.107-.089 0-.042.047-.015.125.068zm10.942 2.943c0 .032-.024.068-.06.084-.03.016-.06-.005-.06-.047 0-.047.03-.084.06-.084.036 0 .06.021.06.047zm-.742.503a.519.519 0 0 1-.18.079c-.035 0-.011-.037.049-.079a.519.519 0 0 1 .18-.079c.035 0 .011.037-.049.079zm-14.064.89c.095.189.095.2.006.136-.054-.042-.084-.083-.066-.1.018-.015.006-.051-.024-.083a.9.9 0 0 1-.09-.162c-.078-.189.072-.016.174.21zm23.241.728c-.155 1.492-.658 2.959-1.417 4.137-.599.922-1.406 1.854-1.586 1.822-.06-.01-.107-.042-.107-.068 0-.031-.03-.037-.066-.016-.048.027-.048.048.006.074.054.026.054.047.006.073-.036.021-.066.068-.066.1 0 .036.042.015.09-.037.047-.058.101-.094.113-.079.018.01-.024.079-.09.152-.083.09-.131.11-.155.063-.03-.068-.138-.037-.138.047 0 .032.03.037.06.021.18-.094.006.1-.377.424-.424.362-.646.519-.556.398.024-.036.012-.063-.024-.063-.066 0-.24-.125-.24-.172 0-.016.055-.037.12-.053.072-.016.12 0 .12.042 0 .079.18.079.275 0 .09-.068.042-.173-.101-.21-.072-.02-.174.006-.264.069-.083.057-.287.12-.448.141-.168.021-.317.058-.335.09-.024.03.047.036.18.015.143-.026.214-.016.214.02 0 .032-.09.058-.197.058-.108 0-.3.047-.43.105a1.214 1.214 0 0 1-.342.105c-.06 0-.107.02-.107.052 0 .068-.198.068-.27.005-.036-.031-.095-.015-.15.037-.077.073-.071.079.019.047.06-.02.101-.01.101.026 0 .037-.083.048-.239.027a1.998 1.998 0 0 0-.778.11c-.077.026-.568.12-.987.188-.233.037-.239.042-.095.079.083.02-.036.036-.3.036a4.24 4.24 0 0 0-.711.058c-.15.037-.563.1-.928.146-1.25.163-2.213.362-3.033.634-.125.037-.227.058-.227.037 0-.09.873-.906 1.268-1.189.3-.21 1.143-.665 1.651-.89 1.28-.56 2.728-.964 4.619-1.288.478-.079 1.777-.21 2.13-.21.197 0 .335-.026.382-.078.054-.058.102-.063.18-.026.143.068.299.068.299.005 0-.026-.048-.063-.102-.074-.095-.02-.095-.026-.006-.031.054 0 .12.016.138.047.018.026.132.053.245.053.138 0 .198-.021.168-.058-.018-.032-.09-.047-.15-.032-.066.016-.114.011-.114-.01 0-.079-1.22-.304-1.764-.33-.18-.01-.33-.031-.33-.057 0-.063-.167-.042-.203.026-.03.052-.042.052-.072 0-.024-.047-.245-.063-.807-.063-.431 0-.766.016-.754.037.018.026-.24.047-.568.052-.766.016-1.663.157-2.92.45-.748.178-1.089.288-1.148.367-.03.042-.048.036-.048-.021 0-.094.646-.676.754-.676.035 0 .095-.057.131-.13.036-.074.102-.132.138-.132.036 0 .048-.036.03-.083-.018-.042-.012-.063.024-.047.035.02.101-.006.155-.053.084-.073.09-.105.024-.214-.048-.069-.096-.126-.114-.126-.036 0-.15.063-.765.387-.305.163-1.305.77-1.448.885-.048.032-.144.1-.215.142-.647.387-1.843 1.471-2.154 1.942l-.15.23v-.46c0-2.1.76-3.828 2.232-5.043a6.127 6.127 0 0 1 2.07-1.152c.73-.24 1.334-.32 2.967-.387 2.931-.12 3.577-.183 4.84-.471.82-.184 1.501-.404 2.279-.728l.598-.246.018.151c.012.09-.006.44-.048.791zM30.27 28.114c-.018.016-.072.021-.114.006-.048-.016-.03-.032.036-.032.066-.005.102.01.078.026zm-1.053.34c.06.106.06.106-.09.022-.084-.053-.138-.11-.12-.136.042-.063.126-.016.21.115zm1.19-.114c0 .031-.024.068-.06.083-.03.016-.06-.005-.06-.047 0-.047.03-.083.06-.083.036 0 .06.02.06.047zm-.012.309c-.077.01-.107.073-.113.21-.006.13-.018.156-.036.067-.048-.204.03-.372.15-.33.095.032.095.037 0 .053zm-.257.01a1.1 1.1 0 0 0-.036.278c-.018.314-.114.261-.114-.063 0-.184.024-.252.09-.252.048 0 .072.016.06.037zm-.084.665c.078.084.072.09-.018.021-.101-.068-.131-.11-.083-.11a.34.34 0 0 1 .101.09zm.24.21c.077.083.071.089-.018.02-.102-.068-.132-.11-.084-.11.012 0 .06.042.102.09zm18.928.277c.018.026-.006.052-.054.052s-.107-.026-.125-.052c-.018-.031.006-.052.053-.052.048 0 .108.02.126.052zm.538.09c-.006.062-.06.088-.155.078-.108-.006-.126 0-.054.036.048.032.072.058.06.068-.018.01-.15.1-.3.194-.46.31-.46.31-.358.194.084-.094.078-.094-.06-.063-.114.031-.126.026-.06-.016a.27.27 0 0 1 .192-.026c.06.016.125-.016.167-.084.036-.057.102-.104.15-.104.12 0 .173-.1.09-.184-.054-.057-.036-.068.083-.057.102.01.156-.01.156-.053 0-.041.024-.073.054-.073s.047.042.035.09zm-1.304.235c-.018.042-.036.026-.036-.032-.006-.057.012-.089.03-.068.018.016.024.063.006.1zm.856-.063c0 .026-.024.052-.06.052-.03 0-.06-.026-.06-.052 0-.032.03-.052.06-.052.036 0 .06.02.06.052zm-.24.157c0 .026-.023.052-.06.052-.03 0-.06-.026-.06-.052 0-.031.03-.052.06-.052.037 0 .06.02.06.052zm-1.56.021c-.013.01-.133.031-.264.047-.162.021-.21.016-.15-.016.084-.047.473-.078.413-.031zm-14.61.487c-.018.052-.03.01-.03-.09 0-.099.012-.14.03-.093a.472.472 0 0 1 0 .183zm12.3-.052a.515.515 0 0 1-.18 0c-.06-.016-.024-.027.072-.027.102 0 .144.01.108.027z"
				/>
				<path
					d="M34.893 16.411c0 .026.03.037.06.02.036-.015.06-.041.06-.057 0-.01-.024-.02-.06-.02-.03 0-.06.026-.06.057zm-.299.11c0 .052.425.052.52 0 .036-.021-.065-.037-.227-.037-.161 0-.293.016-.293.037zm.496.329c0 .116.012.158.024.09a.615.615 0 0 0 0-.21c-.018-.047-.03.006-.023.12zm-.879.121c.03.021.072.058.09.079.018.026.054.01.072-.026.018-.047-.018-.074-.09-.079-.066-.005-.096.005-.072.026zm-4.523 3.205c0 .026.024.052.054.052.024 0 .042.063.03.142-.024.146-.024.146.03.015.024-.073.036-.162.018-.199-.03-.073-.132-.083-.132-.01z"
				/>
				<path
					d="M29.569 20.317c0 .021.042.11.09.189.047.078.077.173.065.21-.006.036-.006.041.012.02.012-.026.078-.005.138.047.108.084.113.084.113 0 0-.1-.137-.24-.233-.24-.036 0-.066-.048-.066-.1 0-.058-.024-.12-.06-.136-.03-.016-.06-.016-.06.01zm.317 6.703c.054.01.137.01.18 0 .035-.016-.007-.026-.108-.026-.096 0-.132.01-.072.026zm.544.304c-.113.073-.107.073.024.078.078 0 .132-.031.132-.078 0-.1-.006-.1-.156 0zm-.293.393c-.048.068-.006.125.084.099.036-.016.042-.052.012-.094-.036-.053-.06-.053-.096-.005zm-1.4.178c-.054.052-.048.078.012.099.048.016.078-.016.078-.073 0-.12 0-.12-.09-.026zm21.758.979c-.06.026-.107.094-.107.146 0 .053-.054.11-.12.126-.15.031-.162.141-.012.141.06-.005.156-.099.233-.235.072-.131.126-.236.12-.236a.753.753 0 0 0-.114.058zm.025.262c-.114.162-.055.172.107.02.096-.088.114-.13.054-.13-.048 0-.12.047-.162.11zm-1.748.528c-.095.037-.12.063-.071.079.047.016.125-.01.179-.058.114-.094.102-.1-.108-.02zm1.197-.01c0 .026.03.052.06.052.036 0 .06-.026.06-.052 0-.031-.024-.052-.06-.052-.03 0-.06.02-.06.052zM46.96 2.948c-.305.21-.258.66.09.817.352.162.765-.068.765-.43 0-.24-.048-.33-.245-.413-.233-.105-.43-.1-.61.026zm-20.765.686c-.395.084-.928.367-1.209.644-.933.906-.903 2.2.072 3.053.832.728 2.124.854 3.099.309.646-.361 1.059-.916 1.19-1.576.174-.89-.418-1.875-1.382-2.289-.347-.151-.454-.172-.963-.183-.317-.005-.676.01-.807.042zm1.13 1.142c.293.115.593.403.688.66.108.287.048.717-.137.958-.18.24-.676.481-.993.481-.509 0-.987-.272-1.179-.665-.108-.22-.108-.638 0-.858.263-.54 1.029-.812 1.621-.576zm24.259.444c0 .011.048.053.108.09.09.068.096.063.018-.021s-.126-.11-.126-.068zm4.182.069c-.078.084-.072.089.024.02.095-.067.125-.11.078-.11a.356.356 0 0 0-.102.09zm-1.502.471c.042.016.096.01.114-.005.024-.016-.012-.032-.078-.026-.066 0-.084.015-.036.031zm.551.016c-.048.026-.06.052-.03.052a.404.404 0 0 0 .15-.052c.047-.026.065-.053.03-.053a.443.443 0 0 0-.15.053zM53.546 7.63c-.598.14-.945.544-.945 1.11 0 .612.467 1.068 1.137 1.11.484.031.825-.084 1.13-.388.647-.644.335-1.581-.604-1.827-.359-.09-.353-.09-.718-.006zm-29.631.591c-.347.356-1.047 1.142-1.047 1.168 0 .016.12.105.264.199.143.094.329.225.418.298l.15.12.287-.271c.497-.477.987-1.022.963-1.074-.024-.063-.771-.634-.82-.628-.017 0-.113.083-.215.188zm-1.609 1.644c-.251.173-.347.398-.395.938a5.211 5.211 0 0 0-.03.513c.048.047.748-.12 1-.236.263-.125.586-.445.586-.581 0-.031-.054-.084-.126-.115a7.84 7.84 0 0 1-.503-.34l-.376-.283zm-1.394 2.357c-.538.304-.251 1.147.389 1.147.425 0 .724-.267.73-.65 0-.22-.03-.277-.204-.43-.167-.146-.245-.177-.46-.177a.954.954 0 0 0-.455.11zm35.853.267c-.144.11-.156.157-.162.639-.012.749.012.712-.514.712-.395 0-.46.016-.592.136-.18.152-.162.356.053.508.108.079.204.089.557.063l.425-.032.041.252c.048.324.222.487.52.487.318 0 .533-.173.575-.461l.036-.22h.401c.479 0 .718-.12.718-.367 0-.246-.24-.366-.718-.366h-.407l-.024-.608c-.018-.591-.024-.607-.185-.733a.607.607 0 0 0-.724-.01zm2.1 4.535c-.407.371-.012.953.532.796.257-.079.383-.236.383-.487 0-.43-.574-.624-.915-.31zM46.978 19.6c0 .031.041.052.09.052.047 0 .09-.01.09-.02 0-.011-.043-.032-.09-.053-.049-.016-.09-.005-.09.021zm-.24.267c.072.042.072.047-.03.037-.131-.016-.269.042-.269.12 0 .084.216.053.317-.047.132-.126.126-.168 0-.168-.095 0-.095.01-.018.058zm-.897.288c0 .073.281.168.359.126.048-.026.036-.047-.042-.063a2.367 2.367 0 0 1-.21-.068c-.06-.021-.107-.016-.107.005zm.029.178c.019.026.06.052.097.052.03 0 .053-.026.053-.052 0-.031-.041-.052-.095-.052-.048 0-.072.02-.054.052zm-1.525.702-.209.068.257.02c.21.022.251.011.251-.067 0-.11-.017-.11-.299-.021zm-.299.157c0 .01.042.037.096.052.048.016.072.01.054-.02-.036-.053-.15-.074-.15-.032zm.287.016c.042.015.096.01.114-.006.024-.015-.012-.031-.078-.026-.066 0-.083.016-.036.032zm15.196 1.618c-.216.1-.347.33-.347.602 0 .173.036.246.203.393.168.146.251.178.449.178.472 0 .79-.252.796-.624 0-.25-.09-.403-.33-.528a.906.906 0 0 0-.771-.021zM57.8 28.81c-.245.216-.24.477.006.697.161.137.215.157.4.131.515-.073.695-.54.33-.827-.258-.204-.503-.2-.736 0zm-34.405 1.347c-.21.094-.287.225-.287.466 0 .43.598.607.963.293.197-.178.221-.361.072-.586-.09-.137-.347-.262-.52-.257a.912.912 0 0 0-.228.084zm31.707 2.058c-.425.146-.676.298-.97.586-.382.377-.532.744-.538 1.33-.006.424.012.508.186.828.233.429.658.806 1.136 1.015.311.131.413.147.916.147.783-.005 1.148-.136 1.68-.597.515-.45.677-.785.677-1.419 0-.393-.024-.487-.186-.796a2.145 2.145 0 0 0-1.083-.995c-.347-.152-.46-.173-.963-.183-.454-.016-.634.005-.855.084zm-30.325.864c-.58.178-.892.597-.892 1.199 0 1.058 1.442 1.555 2.304.796.676-.587.514-1.54-.323-1.922a1.481 1.481 0 0 0-1.09-.073zm7.203 2.591c-.467.252-.234.896.323.896.293 0 .556-.236.556-.497 0-.142-.048-.23-.173-.346-.21-.178-.431-.194-.706-.052z"
				/>
				<path
					class="fill-neutral-700 dark:fill-neutral-200"
					d="M55.552 34.301c2.501 0 5.199-.482 7.625-.934 1.055-.196 1.87-.995 1.87-2.035 0-1.055-.8-1.778-1.9-1.778-1.597 0-4.49.919-6.058.919-1.19 0-1.568-.528-1.568-1.582 0-3.753 2.547-10.73 2.547-14.695 0-1.748-.768-2.923-2.38-2.923-1.493 0-2.653 1.055-2.653 2.908 0 .905.196 1.854.603 2.427-.438 4.054-2.442 9.977-2.442 13.322 0 2.397 1.19 4.371 4.356 4.371zm19.043 6.013c3.994 0 6.541-2.773 7.37-6.993.904-4.49 1.974-10.866 2.276-13.006.256-1.763-.271-2.833-1.537-2.833-1.055 0-1.809.723-2.472 2.11-.92 1.959-3.587 7.219-5.983 9.977l-.302-.106c1.176-4.822 1.613-8.485.98-10.459-.377-1.236-1.13-2.05-2.457-2.05-1.356 0-2.245.739-2.245 2.02 0 .859.392 1.552 1.417 2.17-.121 3.15-.92 5.833-1.025 8.184-.09 2.38.874 3.526 2.456 3.526 1.266 0 2.336-.663 3.467-2.11.859-1.1 1.793-2.682 2.833-4.717l.558.03-1.312 6.345c-.693 3.36-1.914 4.762-3.647 4.762-1.1 0-2.095-.437-3.014-1.16-1.025-.754-1.944-.874-2.683-.06-.723.783-.602 1.688.166 2.456 1.146 1.19 3.12 1.914 5.154 1.914zm17.025-5.742c1.311.287 2.155-.693 2.667-2.08 1.432-3.797 3.617-7.836 5.773-11.001l.512.045c-.392 1.386-.407 2.698-.106 3.768.317 1.13 1.025 1.868 2.352 1.567.949-.196 1.642-.874 1.642-2.788 0-1.356-.226-3.858-.723-5.14-.392-.979-1.04-1.506-2.065-1.506-2.381 0-4.506 2.878-6.872 7.957l-.543-.03c.935-2.26 1.281-3.918 1.281-5.019 0-1.688-.98-2.908-2.803-2.908-.89 0-2.14.256-3.135.633-1.115.407-1.778 1.13-1.431 2.532.331 1.326 1.235 1.386 2.095 1.235.587-.105 1.22-.346 1.748-.587l.346.376c0 2.593-1.205 7.46-1.944 9.902-.512 1.688.076 2.788 1.206 3.044zm20.054-.346c2.32 0 4.656-1.794 6.209-5.773h.392c-.106.905-.166 1.719-.166 2.336 0 2.05.904 3.467 2.652 3.467 1.402 0 2.291-.935 2.291-2.186 0-1.01-.437-1.898-1.236-2.17.467-3.21.95-6.54 1.417-9.57.286-1.899-.09-2.712-1.311-2.878-1.16-.166-1.914.572-2.23 2.095-.664-1.146-2.367-1.749-4.1-1.749-3.451 0-8.304 3.648-8.304 10.595 0 3.904 2.2 5.833 4.386 5.833zm-.724-6.48c0-3.362 2.487-6.647 4.853-6.647.18 0 .362.015.527.045.272 1.04 1.055 1.658 1.975 1.658h.12c-1.462 4.325-4.19 8.078-5.757 8.078-1.266 0-1.718-1.417-1.718-3.135z"
					aria-label="Lyra"
					font-family="Monaspace Radon"
					font-size="30.142"
					font-weight="700"
					letter-spacing=".582"
					style="-inkscape-font-specification: 'Monaspace Radon, Bold'"
					transform="scale(1.2177 .82122)"
					word-spacing=".582"
				/>
			</svg>

			<div class="flex-1"></div>

			<XButton
				icon="i-material-symbols-search-rounded"
				variant="text"
				class="!md:hidden"
				@click="flux.searchDialog = true"
			/>

			<div class="hidden shadow-sm md:flex md:items-center md:rounded-md dark:md:bg-slate-800">
				<XButton
					variant="text"
					size="small"
					class="!h-38px !hover:bg-slate-100 !dark:hover:bg-slate-700 !rounded-md !border-slate-900/10 !text-slate-400"
					@click="flux.searchDialog = true"
				>
					<div class="i-material-symbols-search-rounded h-5 w-5"></div>
					<div>Search</div>

					<div class="ms-2 block">
						<XKeyboard :keys="['command']">K</XKeyboard>
					</div>
				</XButton>
			</div>

			<XButton icon="i-material-symbols-notifications-outline-rounded" variant="text" />

			<XPopover v-model="menuStatus">
				<div
					class="bg-primary-600 w-38px h-38px flex cursor-pointer items-center justify-center rounded-full text-white"
					@click="menuStatus = !menuStatus"
				>
					{{ flux.avatar(flux.user.fullName) }}
				</div>

				<template #content>
					<div class="min-w-75">
						<template v-if="!menuType">
							<div class="px-4 py-2">
								<div class="font-bold">{{ flux.user.fullName }}</div>
								<div class="text-sm">{{ flux.user.email }}</div>
							</div>

							<div class="border dark:border-slate-600"></div>

							<XListbox>
								<XListbox.Item>
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-account-circle-outline h-5 w-5"></div>
										<div>Profile</div>
									</div>
								</XListbox.Item>
								<XListbox.Item>
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-settings-outline-rounded h-5 w-5"></div>
										<div>Settings</div>
									</div>
								</XListbox.Item>
							</XListbox>

							<div class="border dark:border-slate-600"></div>

							<XListbox>
								<XListbox.Item @click="menu('appearance')">
									<div class="flex items-center justify-between">
										<div class="me-2 flex items-center">
											<div
												class="me-2 h-5 w-5"
												:class="{
													'i-material-symbols-light-mode-outline-rounded': colorMode === 'light',
													'i-material-symbols-dark-mode-outline-rounded': colorMode === 'dark',
													'i-material-symbols-desktop-windows-outline-rounded':
														colorMode === 'auto',
												}"
											></div>
											<div>
												Appearance:
												{{ colorMode === 'light' ? 'Light' : '' }}
												{{ colorMode === 'dark' ? 'Dark' : '' }}
												{{ colorMode === 'auto' ? 'System' : '' }}
											</div>
										</div>

										<div class="i-material-symbols-chevron-right-rounded h-5 w-5"></div>
									</div>
								</XListbox.Item>
								<XListbox.Item @click="menu('language')">
									<div class="flex items-center justify-between">
										<div class="me-2 flex items-center">
											<div class="i-material-symbols-translate-rounded me-2 h-5 w-5"></div>
											<div>
												Language:
												{{
													languageOptions.find((lang) => lang.value === localer.lang.value)?.label
												}}
											</div>
										</div>

										<div class="i-material-symbols-chevron-right-rounded h-5 w-5"></div>
									</div>
								</XListbox.Item>
							</XListbox>

							<div class="border dark:border-slate-600"></div>

							<XListbox>
								<XListbox.Item @click="flux.signOut">
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-logout-rounded h-5 w-5"></div>
										<div>Sign out</div>
									</div>
								</XListbox.Item>
							</XListbox>
						</template>

						<template v-if="menuType === 'appearance'">
							<div class="flex items-center gap-2 p-2">
								<XButton
									icon="i-material-symbols-arrow-back-rounded"
									variant="text"
									@click="menu('')"
								/>
								<div>Appearance</div>
							</div>

							<div class="border dark:border-slate-600"></div>

							<div class="mt-3 px-4 text-sm text-gray-400 dark:text-gray-500">
								Setting applies to this browser only
							</div>

							<XListbox>
								<XListbox.Item @click="colorMode = 'light'">
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-light-mode-outline-rounded h-5 w-5"></div>
										<div>Light</div>
									</div>
								</XListbox.Item>
								<XListbox.Item @click="colorMode = 'dark'">
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-dark-mode-outline-rounded h-5 w-5"></div>
										<div>Dark</div>
									</div>
								</XListbox.Item>
								<XListbox.Item @click="colorMode = 'auto'">
									<div class="flex items-center gap-2">
										<div class="i-material-symbols-desktop-windows-outline-rounded h-5 w-5"></div>
										<div>System</div>
									</div>
								</XListbox.Item>
							</XListbox>
						</template>

						<template v-if="menuType === 'language'">
							<div class="flex items-center gap-2 p-2">
								<XButton
									icon="i-material-symbols-arrow-back-rounded"
									variant="text"
									@click="menu('')"
								/>
								<div>Language</div>
							</div>

							<div class="border dark:border-slate-600"></div>

							<XListbox>
								<XListbox.Item
									v-for="lang in languageOptions"
									:key="lang.value"
									@click="changeLang(lang.value)"
								>
									<div class="flex items-center gap-2">
										<div
											class="h-5 w-5"
											:class="{
												'i-material-symbols-check-small-rounded': lang.value === localer.lang.value,
											}"
										></div>
										<div>{{ lang.label }}</div>
									</div>
								</XListbox.Item>
							</XListbox>
						</template>
					</div>
				</template>
			</XPopover>
		</header>

		<nav class="Sidebar">
			<Navbar />
		</nav>

		<div class="flex h-full flex-col">
			<main class="Page">
				<slot></slot>
			</main>

			<footer class="Footer">
				<div class="text-sm">Copyright © {{ new Date().getFullYear() }} Lorem Ipsum</div>
			</footer>
		</div>
	</div>

	<XDrawer
		v-if="flux"
		v-model="flux.navDrawer"
		:placement="textDirection === 'rtl' ? 'right' : 'left'"
		class="px-2 pb-20 pt-4"
	>
		<Navbar />
	</XDrawer>

	<XDialog v-if="flux" v-model="flux.authDialog" class="!w-100">
		<div class="text-2xl">{{ flux.userError.error }}</div>
		<div class="my-2">{{ flux.userError.message }}</div>

		<div class="flex justify-end">
			<XButton @click="flux.authDialog = false">Okay, got it</XButton>
		</div>
	</XDialog>

	<XDialog v-if="flux" v-model="flux.searchDialog">
		<XTextField placeholder="Search here..." prepend="i-material-symbols-search-rounded" />
		<div class="h-66 flex items-center justify-center">No recent searches</div>
	</XDialog>

	<IdleDialog />
</template>

<style lang="scss" scoped>
.Topbar {
	@apply z-100 fixed top-0;
	@apply flex w-full items-center gap-3 px-4 py-4 md:gap-4 md:px-6;
	@apply border-b bg-white/75 shadow backdrop-blur dark:border-slate-700 dark:bg-slate-900/75;
}

.Sidebar {
	@apply top-18 z-99 fixed bottom-0 start-0 overflow-y-auto;
	@apply hidden w-64 px-2 pb-20 pt-4 xl:block;
	@apply border-e bg-white shadow dark:border-slate-700 dark:bg-slate-900;
	scrollbar-width: none;
}

.Page {
	@apply container flex-1 self-center;
	@apply pt-22 lg:pt-26 md:pt-24;
	@apply ps-2 md:ps-4 lg:ps-6 xl:ps-72;
	@apply pb-2 md:pb-4 lg:pb-6;
	@apply pe-2 md:pe-4 lg:pe-6;
}

.Footer {
	@apply flex flex flex-col justify-center gap-2 p-8 md:flex-row;
	@apply border-t bg-slate-50 dark:border-slate-700 dark:bg-slate-900;
	@apply xl:ps-72;
}
</style>
