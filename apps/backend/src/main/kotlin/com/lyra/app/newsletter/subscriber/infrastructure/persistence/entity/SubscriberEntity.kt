package com.lyra.app.newsletter.subscriber.infrastructure.persistence.entity

import com.lyra.app.newsletter.subscriber.domain.Attributes
import com.lyra.app.newsletter.subscriber.domain.SubscriberStatus
import com.lyra.common.domain.AuditableEntity
import java.time.LocalDateTime
import java.util.*
import org.springframework.data.relational.core.mapping.Column
import org.springframework.data.relational.core.mapping.Table

@Table("subscribers")
data class SubscriberEntity(
    // id is generated by the frontend and sent to the backend as a UUID
    val id: UUID,
    val email: String,
    val firstname: String? = null,
    var lastname: String? = null,
    @Column("status")
    var status: SubscriberStatus,
    @Column("attributes")
    val attributes: Attributes? = Attributes(),
    val organizationId: UUID,
    override var createdAt: LocalDateTime = LocalDateTime.now(),
    override var updatedAt: LocalDateTime? = LocalDateTime.now(),
) : AuditableEntity(createdAt, updatedAt) {

    companion object {
        fun create(
            id: UUID,
            email: String,
            firstname: String?,
            lastname: String?,
            status: SubscriberStatus,
            attributes: Attributes?,
            organizationId: UUID,
            createdAt: LocalDateTime,
            updatedAt: LocalDateTime?,
        ): SubscriberEntity {
            val entity = SubscriberEntity(
                id = id,
                email = email,
                firstname = firstname,
                lastname = lastname,
                status = status,
                attributes = attributes,
                organizationId = organizationId,
                createdAt = createdAt,
                updatedAt = updatedAt,
            )
            return entity
        }
    }
}
